<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <style>
        table {
          width: 100%;
          border: 1px solid #444444;
        }
        th, td {
          border: 1px solid #444444;
        }
      </style>
</head>


<body >
    <div style="text-align: center;">
<input id="booksearchinput" name="booksearchinput"> <button onclick="bookadd()"> 책추가 </button>
<p id="result"></p>
<center>
    <div id="resulttd" class="resulttd" style="text-align: center;">
        <table>
            <thead>
                <tr>
                    <th>기억의서</th>
                    <th>보유갯수</th>
                    </td>
                    <th>버튼</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="resulatpage">

                <td>

                </td>
            </tbody>
        </table>
    </div>

</center>

</div>
<script>
    const message = document.querySelector('#booksearchinput');
    const result = document.querySelector('#result');
    const resulttd = document.getElementById('resulatpage');
    

    function plusbook(bookname, plusminus) {
        var bookcnt = localStorage.getItem(bookname.id)
        var numbookcnt = parseInt(bookcnt);

        if( plusminus == 1)
            numbookcnt += 1;
        else if(plusminus == 2 )
            numbookcnt -= 1;
        else if( plusminus == 3  )
        {
            localStorage.removeItem(bookname.id);
            searchbook(bookname.id)
            return;
        }


        bookcnt = String(numbookcnt);
        localStorage.setItem(bookname.id, bookcnt)
        var numb = document.getElementById(bookname.id+'id');
        numb.innerText = bookcnt;
        
     }

     function bookadd()
     {
        for (var i = 0; i < localStorage.length; i++) {
            if (localStorage.key(i) == true)
            {
               return;
            }
                    
        }
        localStorage.setItem(message.value, 0)
        searchbook(message.value)
     }

     function createtd(bookname)
     {
        var te = "<tr> <td> " + bookname + "</td> <td id='"+bookname+"id'>" + localStorage.getItem(bookname) +"</td>"+
            "<td> <button id='" +bookname +"' onclick=plusbook(this,1)>더하기</button> </td>"+ 
            "<td> <button id='" +bookname +"' onclick=plusbook(this,2)>빼기</button> </td>"+ 
            "<td> <button id='" +bookname +"' onclick=plusbook(this,3)>삭제</button> </td>"+ 
            " </tr>";

            return te;
            
     }

     function searchbook(bookname)
     {
        var searchresulatpage = ""
        if (bookname.trim() != "") {

            for (var i = 0; i < localStorage.length; i++) {
                if (localStorage.key(i).includes(bookname) == true)
                {
                    result.textContent = localStorage.key(i);
                    searchresulatpage = searchresulatpage + createtd(localStorage.key(i) );
                }
                        
            }
        }
        
        resulttd.innerHTML = searchresulatpage;
     }
    
    message.addEventListener('input', function () {
        searchbook(this.value)
    });
</script>
</body>
</html>